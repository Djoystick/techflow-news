<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechFlow Admin Panel v2.4 - FIXED</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding-bottom: 50px;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .admin-version {
            font-size: 12px;
            color: #999;
            padding: 4px 8px;
            background: #f5f5f5;
            border-radius: 4px;
        }

        .logout-btn {
            padding: 10px 20px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 120px;
            text-align: center;
        }

        .nav-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 150px;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn-danger:hover {
            background: #cc0000;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
            min-width: auto;
        }

        .status-message {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.show {
            display: block;
            animation: slideDown 0.3s ease-in-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .news-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
            flex-wrap: wrap;
        }

        .news-item-info {
            flex: 1;
            min-width: 200px;
        }

        .news-item-title {
            font-weight: 700;
            margin-bottom: 5px;
            color: #333;
        }

        .news-item-meta {
            font-size: 12px;
            color: #999;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .news-item-actions {
            display: flex;
            gap: 10px;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .template-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .template-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .template-name {
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }

        .template-desc {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .diagnostic-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .diagnostic-item.success {
            border-color: #4caf50;
            background: #f1f8f4;
        }

        .diagnostic-item.error {
            border-color: #f44336;
            background: #fef5f5;
        }

        .diagnostic-item.warning {
            border-color: #ff9800;
            background: #fff8f0;
        }

        .diagnostic-name {
            font-weight: 600;
            color: #333;
            flex: 1;
            min-width: 200px;
        }

        .diagnostic-status {
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .diagnostic-status.ok {
            background: #4caf50;
            color: white;
        }

        .diagnostic-status.failed {
            background: #f44336;
            color: white;
        }

        .diagnostic-status.warning {
            background: #ff9800;
            color: white;
        }

        .diagnostic-details {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-size: 11px;
            color: #666;
            word-break: break-all;
            margin-top: 10px;
            display: none;
        }

        .diagnostic-details.show {
            display: block;
        }

        .logs-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .log-entry.error {
            color: #ff4444;
        }

        .log-entry.warning {
            color: #ffaa00;
        }

        .log-entry.success {
            color: #00ff00;
        }

        .log-entry.info {
            color: #00aaff;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .category-list {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .category-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-emoji {
            font-size: 18px;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .admin-container { padding: 15px; }
            .tab-content { padding: 20px; }
            .admin-header { flex-direction: column; align-items: flex-start; }
            .admin-nav { width: 100%; }
            .nav-btn { flex: 1; min-width: 100px; }
            .form-buttons { flex-direction: column; }
            .btn { width: 100%; }
            .grid-2 { grid-template-columns: 1fr; }
            .news-item { flex-direction: column; }
            .news-item-actions { width: 100%; }
        }

        @media (max-width: 480px) {
            .admin-container { padding: 10px; }
            .tab-content { padding: 15px; }
            .admin-title { font-size: 16px; }
            .nav-btn { padding: 8px 10px; font-size: 11px; min-width: 70px; }
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div>
                <div class="admin-title">üì∞ TechFlow Admin Panel</div>
                <div class="admin-version">v2.4 - FULLY FIXED</div>
            </div>
            <button class="logout-btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>
        </div>

        <div id="statusMessage" class="status-message"></div>

        <div class="admin-nav">
            <button class="nav-btn active" onclick="switchTab('add-news')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="nav-btn" onclick="switchTab('manage-news')">‚úèÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
            <button class="nav-btn" onclick="switchTab('templates')">üìã –®–∞–±–ª–æ–Ω—ã</button>
            <button class="nav-btn" onclick="switchTab('categories')">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
            <button class="nav-btn" onclick="switchTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="nav-btn" onclick="switchTab('diagnostics')">üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
        </div>

        <!-- 1Ô∏è‚É£ –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–û–°–¢–¨ -->
        <div id="add-news" class="tab-content active">
            <h2 style="margin-bottom: 20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h2>

            <div class="form-group">
                <label class="form-label">üìå –ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="newsTitle" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏...">
            </div>

            <div class="form-group">
                <label class="form-label">üìù –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="newsExcerpt" class="form-textarea" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ª–µ–Ω—Ç—ã..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">üìñ –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
                <textarea id="newsFullText" class="form-textarea" placeholder="–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏..."></textarea>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ URL</label>
                    <input type="text" id="newsImage" class="form-input" placeholder="https://example.com/image.jpg">
                </div>

                <div class="form-group">
                    <label class="form-label">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="newsCategory" class="form-select"></select>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">üë§ –ê–≤—Ç–æ—Ä</label>
                    <input type="text" id="newsAuthor" class="form-input" placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞...">
                </div>

                <div class="form-group">
                    <label class="form-label">üîó –ò—Å—Ç–æ—á–Ω–∏–∫</label>
                    <input type="text" id="newsSource" class="form-input" placeholder="https://example.com">
                </div>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="newsFeatured"> ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å
                </label>
            </div>

            <div class="form-buttons">
                <button class="btn btn-primary" onclick="addNews()">üíæ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="clearForm()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <!-- 2Ô∏è‚É£ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–°–¢–Ø–ú–ò -->
        <div id="manage-news" class="tab-content">
            <h2 style="margin-bottom: 20px;">‚úèÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</h2>
            <input type="text" id="searchNews" class="form-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." style="margin-bottom: 20px;">
            <div class="news-item" id="newsList" style="display: block;">
                <p style="text-align: center; color: #999; padding: 40px;">–ó–∞–≥—Ä—É–∂–∞—é –Ω–æ–≤–æ—Å—Ç–∏...</p>
            </div>
        </div>

        <!-- 3Ô∏è‚É£ –®–ê–ë–õ–û–ù–´ -->
        <div id="templates" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìã –®–∞–±–ª–æ–Ω—ã —Å—Ç–∞—Ç–µ–π</h2>

            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px;">üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω</h3>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label>
                    <input type="text" id="templateName" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–±–∑–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞">
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <input type="text" id="templateDesc" class="form-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞...">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞</label>
                    <textarea id="templateContent" class="form-textarea" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="createTemplate()">‚ûï –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
            </div>

            <hr style="margin: 30px 0;">

            <h3 style="margin-bottom: 15px;">üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã</h3>
            <div class="templates-grid" id="templatesGrid"></div>
        </div>

        <!-- 4Ô∏è‚É£ –ö–ê–¢–ï–ì–û–†–ò–ò -->
        <div id="categories" class="tab-content">
            <h2 style="margin-bottom: 20px;">üè∑Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h2>

            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                        <input type="text" id="categoryId" class="form-input" placeholder="ai, gadgets, software...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="categoryName" class="form-input" placeholder="–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç...">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–≠–º–æ–¥–∑–∏</label>
                    <input type="text" id="categoryEmoji" class="form-input" placeholder="ü§ñ">
                </div>
                <button class="btn btn-primary" onclick="addCategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <hr style="margin: 30px 0;">

            <h3 style="margin-bottom: 15px;">üìã –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
            <div class="category-list" id="categoriesList"></div>
        </div>

        <!-- 5Ô∏è‚É£ –ù–ê–°–¢–†–û–ô–ö–ò -->
        <div id="settings" class="tab-content">
            <h2 style="margin-bottom: 20px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

            <div class="form-group">
                <label class="form-label">üîë GitHub Token</label>
                <input type="password" id="githubToken" class="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                <small style="color: #999;">–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞ GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal Access Tokens</small>
            </div>

            <div class="form-group">
                <label class="form-label">üë§ GitHub Username</label>
                <input type="text" id="githubUsername" class="form-input" placeholder="–≤–∞—à–µ_–∏–º—è_–Ω–∞_github">
            </div>

            <div class="form-group">
                <label class="form-label">üìÇ –ò–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</label>
                <input type="text" id="githubRepo" class="form-input" placeholder="techflow-news">
            </div>

            <button class="btn btn-primary" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

            <hr style="margin: 30px 0;">

            <h3 style="margin-bottom: 20px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div>
                <div style="margin-bottom: 15px;"><strong>üì∞ –ù–æ–≤–æ—Å—Ç–µ–π:</strong> <span id="totalNews">0</span></div>
                <div style="margin-bottom: 15px;"><strong>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:</strong> <span id="totalComments">0</span></div>
                <div style="margin-bottom: 15px;"><strong>üìÅ –†–∞–∑–º–µ—Ä:</strong> <span id="storageSize">0 B</span></div>
                <div><strong>üïê –û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> <span id="lastUpdate">-</span></div>
            </div>
        </div>

        <!-- 6Ô∏è‚É£ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê -->
        <div id="diagnostics" class="tab-content">
            <h2 style="margin-bottom: 20px;">üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
            <button class="btn btn-primary" onclick="runDiagnostics()" style="margin-bottom: 20px;">üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>

            <div id="diagnosticsList" style="margin-top: 20px;"></div>

            <hr style="margin: 30px 0;">

            <h3 style="margin-bottom: 15px;">üêõ –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
            <div class="logs-container" id="logsContainer">–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>

            <div class="form-buttons">
                <button class="btn btn-primary" onclick="downloadLogs()">üì• –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏</button>
                <button class="btn btn-secondary" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            </div>
        </div>
    </div>

    <script>
        // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ì–õ–û–ë–ê–õ–¨–ù–´–ï =====
        let allNews = [];
        let allComments = {};
        let allCategories = [];
        let allTemplates = [];
        let systemLogs = [];

        const GITHUB_API_URL = 'https://api.github.com';

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let githubToken = localStorage.getItem('techflow_github_token') || '';
        let githubUsername = localStorage.getItem('techflow_github_username') || '';
        let githubRepo = localStorage.getItem('techflow_github_repo') || 'techflow-news';

        // ===== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï =====
        function addLog(type, message, details = '') {
            const timestamp = new Date().toLocaleTimeString('ru-RU');
            const logEntry = {
                time: timestamp,
                type: type,
                message: message,
                details: details
            };
            
            systemLogs.unshift(logEntry);
            if (systemLogs.length > 200) systemLogs.pop();
            
            console.log(`[${type}] ${message}`, details);
            updateLogsDisplay();
        }

        function updateLogsDisplay() {
            const container = document.getElementById('logsContainer');
            if (systemLogs.length === 0) {
                container.innerHTML = '<div class="log-entry info">–õ–æ–≥–∏ –ø—É—Å—Ç—ã</div>';
                return;
            }

            container.innerHTML = systemLogs.map(log => {
                const className = log.type === 'ERROR' ? 'error' : 
                                log.type === 'WARNING' ? 'warning' : 
                                log.type === 'SUCCESS' ? 'success' : 'info';
                
                let html = `<div class="log-entry ${className}">
                    [${log.time}] ${log.type}: ${log.message}`;
                
                if (log.details) {
                    html += `<div style="margin-left: 20px; margin-top: 5px; opacity: 0.8; font-size: 10px;">
                        ${log.details.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                    </div>`;
                }
                
                html += `</div>`;
                return html;
            }).join('');
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        document.addEventListener('DOMContentLoaded', function() {
            const password = localStorage.getItem('techflow_admin_logged');
            if (!password) {
                const pwd = prompt('üîê –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏:');
                if (pwd !== 'admin123') {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                    window.location.href = '/';
                    return;
                }
                localStorage.setItem('techflow_admin_logged', 'true');
            }

            addLog('INFO', 'Admin panel initialized');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadAllNews();
            loadAllComments();
            loadCategories();
            loadTemplates();
            updateStatistics();

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('githubToken').value = localStorage.getItem('techflow_github_token') || '';
            document.getElementById('githubUsername').value = localStorage.getItem('techflow_github_username') || '';
            document.getElementById('githubRepo').value = localStorage.getItem('techflow_github_repo') || 'techflow-news';

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ localStorage
            githubToken = localStorage.getItem('techflow_github_token') || '';
            githubUsername = localStorage.getItem('techflow_github_username') || '';
            githubRepo = localStorage.getItem('techflow_github_repo') || 'techflow-news';

            updateCategorySelect();
            displayTemplates();
            displayCategories();
        });

        // ===== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö =====
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (tabName === 'manage-news') {
                displayNewsList();
            } else if (tabName === 'diagnostics') {
                runDiagnostics();
            } else if (tabName === 'categories') {
                displayCategories();
            } else if (tabName === 'templates') {
                displayTemplates();
            }
        }

        // ===== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• =====
        async function loadAllNews() {
            try {
                const response = await fetch('data/news.json');
                if (response.ok) {
                    allNews = await response.json();
                    addLog('SUCCESS', 'News loaded', `${allNews.length} items`);
                } else {
                    addLog('WARNING', 'news.json not found', `Status: ${response.status}`);
                    allNews = [];
                }
            } catch (error) {
                addLog('ERROR', 'Failed to load news', error.message);
                allNews = [];
            }
        }

        async function loadAllComments() {
            try {
                const response = await fetch('data/comments.json');
                if (response.ok) {
                    allComments = await response.json();
                    addLog('SUCCESS', 'Comments loaded');
                } else {
                    addLog('WARNING', 'comments.json not found');
                    allComments = {};
                }
            } catch (error) {
                addLog('ERROR', 'Failed to load comments', error.message);
                allComments = {};
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch('data/categories.json');
                if (response.ok) {
                    allCategories = await response.json();
                    addLog('SUCCESS', 'Categories loaded', `${allCategories.length} items`);
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    allCategories = [
                        { id: 'ai', name: '–ò–ò', emoji: 'ü§ñ' },
                        { id: 'gadgets', name: '–ì–∞–¥–∂–µ—Ç—ã', emoji: 'üì±' },
                        { id: 'software', name: '–ü–û', emoji: 'üíª' },
                        { id: 'hardware', name: '–ñ–µ–ª–µ–∑–æ', emoji: 'üîß' },
                        { id: 'crypto', name: '–ö—Ä–∏–ø—Ç–æ', emoji: 'üí∞' }
                    ];
                    addLog('WARNING', 'Using default categories');
                }
            } catch (error) {
                addLog('ERROR', 'Failed to load categories', error.message);
                allCategories = [];
            }
        }

        async function loadTemplates() {
            try {
                const response = await fetch('data/templates.json');
                if (response.ok) {
                    allTemplates = await response.json();
                    addLog('SUCCESS', 'Templates loaded', `${allTemplates.length} items`);
                } else {
                    allTemplates = getDefaultTemplates();
                }
            } catch (error) {
                addLog('ERROR', 'Failed to load templates', error.message);
                allTemplates = getDefaultTemplates();
            }
        }

        function getDefaultTemplates() {
            return [
                {
                    id: 1,
                    name: 'üöÄ –ü—Ä–æ–¥—É–∫—Ç –∑–∞–ø—É—Å–∫',
                    desc: '–î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
                    content: '### –û –ø—Ä–æ–¥—É–∫—Ç–µ\n\n[–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞]\n\n### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏\n\n- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å 1\n- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å 2\n- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å 3'
                },
                {
                    id: 2,
                    name: 'üìä –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞',
                    desc: '–î–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç–∞—Ç–µ–π',
                    content: '### –û–±–∑–æ—Ä —Ä—ã–Ω–∫–∞\n\n[–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è]\n\n### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏\n\n1. –¢–µ–Ω–¥–µ–Ω—Ü–∏—è 1\n2. –¢–µ–Ω–¥–µ–Ω—Ü–∏—è 2\n\n### –ü—Ä–æ–≥–Ω–æ–∑\n\n[–ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞–∑–≤–∏—Ç–∏—è]'
                }
            ];
        }

        // ===== –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–û–°–¢–¨ =====
        async function addNews() {
            const title = document.getElementById('newsTitle').value.trim();
            const excerpt = document.getElementById('newsExcerpt').value.trim();
            const fullText = document.getElementById('newsFullText').value.trim();
            const image = document.getElementById('newsImage').value.trim();
            const category = document.getElementById('newsCategory').value;
            const author = document.getElementById('newsAuthor').value.trim();
            const source = document.getElementById('newsSource').value.trim();
            const featured = document.getElementById('newsFeatured').checked;

            if (!title || !excerpt || !fullText) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'error');
                addLog('ERROR', 'Validation failed', 'Missing required fields');
                return;
            }

            const newNews = {
                id: 'news-' + Date.now(),
                title: title,
                excerpt: excerpt,
                fullText: fullText,
                image: image || 'assets/images/default.jpg',
                category: category,
                author: author || '–ê–≤—Ç–æ—Ä',
                source: source || '#',
                date: new Date().toLocaleDateString('ru-RU'),
                featured: featured
            };

            allNews.unshift(newNews);
            addLog('INFO', 'News item created', `ID: ${newNews.id}`);

            const saved = await saveNewsToGitHub();
            if (saved) {
                showMessage('‚úÖ –ù–æ–≤–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!', 'success');
                clearForm();
                updateStatistics();
            } else {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞ GitHub!', 'error');
            }
        }

        // ===== –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê GITHUB (–ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï) =====
        async function saveNewsToGitHub() {
            if (!githubToken || !githubUsername) {
                showMessage('‚ùå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ GitHub —Ç–æ–∫–µ–Ω –∏ username –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö!', 'error');
                addLog('ERROR', 'GitHub config missing', 'Token or username not set');
                return false;
            }

            try {
                const content = JSON.stringify(allNews, null, 2);
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º TextEncoder –≤–º–µ—Å—Ç–æ btoa –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏
                const encoder = new TextEncoder();
                const encoded = encoder.encode(content);
                const binary = Array.from(encoded).map(b => String.fromCharCode(b)).join('');
                const base64 = btoa(binary);

                const url = `${GITHUB_API_URL}/repos/${githubUsername}/${githubRepo}/contents/data/news.json`;
                
                addLog('INFO', 'Saving to GitHub', `URL: ${url}`);

                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'üì∞ Update news',
                        content: base64,
                        branch: 'main'
                    })
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    addLog('SUCCESS', 'Saved to GitHub', 'news.json updated');
                    return true;
                } else {
                    const errorMsg = responseText;
                    addLog('ERROR', 'GitHub save failed', `Status: ${response.status}, ${errorMsg.substring(0, 200)}`);
                    showMessage(`‚ùå GitHub –æ—à–∏–±–∫–∞: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                addLog('ERROR', 'GitHub save exception', error.message);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏!', 'error');
                return false;
            }
        }

        // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò =====
        async function addCategory() {
            const id = document.getElementById('categoryId').value.trim();
            const name = document.getElementById('categoryName').value.trim();
            const emoji = document.getElementById('categoryEmoji').value.trim();

            if (!id || !name || !emoji) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }

            if (allCategories.find(c => c.id === id)) {
                showMessage('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                return;
            }

            allCategories.push({ id, name, emoji });
            addLog('SUCCESS', 'Category added', `${name} (${id})`);

            document.getElementById('categoryId').value = '';
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryEmoji').value = '';

            await saveCategoryToGitHub();
            updateCategorySelect();
            displayCategories();
            showMessage('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
        }

        async function deleteCategory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) return;

            allCategories = allCategories.filter(c => c.id !== id);
            addLog('SUCCESS', 'Category deleted', id);

            await saveCategoryToGitHub();
            updateCategorySelect();
            displayCategories();
            showMessage('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
        }

        async function saveCategoryToGitHub() {
            if (!githubToken || !githubUsername) return;

            try {
                const content = JSON.stringify(allCategories, null, 2);
                const encoder = new TextEncoder();
                const encoded = encoder.encode(content);
                const binary = Array.from(encoded).map(b => String.fromCharCode(b)).join('');
                const base64 = btoa(binary);

                const url = `${GITHUB_API_URL}/repos/${githubUsername}/${githubRepo}/contents/data/categories.json`;

                await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'üè∑Ô∏è Update categories',
                        content: base64,
                        branch: 'main'
                    })
                });
            } catch (error) {
                addLog('WARNING', 'Failed to save categories', error.message);
            }
        }

        function updateCategorySelect() {
            const select = document.getElementById('newsCategory');
            select.innerHTML = allCategories.map(cat => 
                `<option value="${cat.id}">${cat.emoji} ${cat.name}</option>`
            ).join('');
        }

        function displayCategories() {
            const list = document.getElementById('categoriesList');
            if (allCategories.length === 0) {
                list.innerHTML = '<p>–ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç</p>';
                return;
            }

            list.innerHTML = allCategories.map(cat => `
                <div class="category-item">
                    <div>
                        <span class="category-emoji">${cat.emoji}</span>
                        <strong>${cat.name}</strong> <small>(${cat.id})</small>
                    </div>
                    <button class="btn btn-small btn-danger" onclick="deleteCategory('${cat.id}')">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –®–ê–ë–õ–û–ù–ê–ú–ò =====
        async function createTemplate() {
            const name = document.getElementById('templateName').value.trim();
            const desc = document.getElementById('templateDesc').value.trim();
            const content = document.getElementById('templateContent').value.trim();

            if (!name || !desc || !content) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }

            const newTemplate = {
                id: Date.now(),
                name: name,
                desc: desc,
                content: content
            };

            allTemplates.unshift(newTemplate);
            addLog('SUCCESS', 'Template created', name);

            document.getElementById('templateName').value = '';
            document.getElementById('templateDesc').value = '';
            document.getElementById('templateContent').value = '';

            await saveTemplateToGitHub();
            displayTemplates();
            showMessage('‚úÖ –®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω!', 'success');
        }

        async function deleteTemplate(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω?')) return;

            allTemplates = allTemplates.filter(t => t.id !== id);
            addLog('SUCCESS', 'Template deleted', id);

            await saveTemplateToGitHub();
            displayTemplates();
            showMessage('‚úÖ –®–∞–±–ª–æ–Ω —É–¥–∞–ª–µ–Ω!', 'success');
        }

        async function saveTemplateToGitHub() {
            if (!githubToken || !githubUsername) return;

            try {
                const content = JSON.stringify(allTemplates, null, 2);
                const encoder = new TextEncoder();
                const encoded = encoder.encode(content);
                const binary = Array.from(encoded).map(b => String.fromCharCode(b)).join('');
                const base64 = btoa(binary);

                const url = `${GITHUB_API_URL}/repos/${githubUsername}/${githubRepo}/contents/data/templates.json`;

                await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'üìã Update templates',
                        content: base64,
                        branch: 'main'
                    })
                });
            } catch (error) {
                addLog('WARNING', 'Failed to save templates', error.message);
            }
        }

        function displayTemplates() {
            const grid = document.getElementById('templatesGrid');
            if (allTemplates.length === 0) {
                grid.innerHTML = '<p>–®–∞–±–ª–æ–Ω–æ–≤ –Ω–µ—Ç</p>';
                return;
            }

            grid.innerHTML = allTemplates.map(template => `
                <div class="template-card">
                    <div class="template-name">${template.name}</div>
                    <div class="template-desc">${template.desc}</div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="btn btn-small btn-primary" style="flex: 1;" onclick="useTemplate(${template.id})">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-small btn-danger" onclick="deleteTemplate(${template.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function useTemplate(templateId) {
            const template = allTemplates.find(t => t.id === templateId);
            if (!template) return;

            document.getElementById('newsExcerpt').value = template.content.substring(0, 200) || '';
            document.getElementById('newsFullText').value = template.content;
            switchTab('add-news');
            showMessage('‚úÖ –®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
            addLog('INFO', 'Template used', template.name);
        }

        // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–°–¢–Ø–ú–ò =====
        function displayNewsList() {
            const newsList = document.getElementById('newsList');
            const searchTerm = document.getElementById('searchNews').value.toLowerCase();

            let filtered = allNews;
            if (searchTerm) {
                filtered = allNews.filter(n => n.title.toLowerCase().includes(searchTerm));
            }

            if (filtered.length === 0) {
                newsList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">–ù–æ–≤–æ—Å—Ç–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }

            newsList.innerHTML = filtered.map(news => `
                <div class="news-item">
                    <div class="news-item-info">
                        <div class="news-item-title">${news.title}</div>
                        <div class="news-item-meta">
                            <span>üìÖ ${news.date}</span>
                            <span>üë§ ${news.author}</span>
                            <span>üìÅ ${news.category}</span>
                        </div>
                    </div>
                    <div class="news-item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editNews('${news.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteNews('${news.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        async function deleteNews(newsId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')) return;

            allNews = allNews.filter(n => n.id !== newsId);
            addLog('SUCCESS', 'News deleted', newsId);

            await saveNewsToGitHub();
            displayNewsList();
            updateStatistics();
            showMessage('‚úÖ –ù–æ–≤–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞!', 'success');
        }

        function editNews(newsId) {
            const news = allNews.find(n => n.id === newsId);
            if (!news) return;

            document.getElementById('newsTitle').value = news.title;
            document.getElementById('newsExcerpt').value = news.excerpt;
            document.getElementById('newsFullText').value = news.fullText;
            document.getElementById('newsImage').value = news.image;
            document.getElementById('newsCategory').value = news.category;
            document.getElementById('newsAuthor').value = news.author;
            document.getElementById('newsSource').value = news.source;
            document.getElementById('newsFeatured').checked = news.featured || false;

            switchTab('add-news');
        }

        function clearForm() {
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsExcerpt').value = '';
            document.getElementById('newsFullText').value = '';
            document.getElementById('newsImage').value = '';
            document.getElementById('newsAuthor').value = '';
            document.getElementById('newsSource').value = '';
            document.getElementById('newsFeatured').checked = false;
        }

        // ===== –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê–°–¢–†–û–ï–ö =====
        function saveSettings() {
            const token = document.getElementById('githubToken').value.trim();
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();

            if (!token || !username || !repo) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }

            localStorage.setItem('techflow_github_token', token);
            localStorage.setItem('techflow_github_username', username);
            localStorage.setItem('techflow_github_repo', repo);

            githubToken = token;
            githubUsername = username;
            githubRepo = repo;

            showMessage('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            addLog('SUCCESS', 'Settings saved');
        }

        // ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê =====
        function updateStatistics() {
            document.getElementById('totalNews').textContent = allNews.length;

            let totalComments = 0;
            for (let key in allComments) {
                totalComments += (allComments[key] || []).length;
            }
            document.getElementById('totalComments').textContent = totalComments;

            const size = (JSON.stringify(allNews).length + JSON.stringify(allComments).length) / 1024;
            document.getElementById('storageSize').textContent = size.toFixed(2) + ' KB';

            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ru-RU');
        }

        // ===== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (–ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–†–ê–ë–û–¢–ê–ù–ê) =====
        async function runDiagnostics() {
            const list = document.getElementById('diagnosticsList');
            list.innerHTML = '<p style="text-align: center;"><span class="spinner"></span> –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...</p>';

            addLog('INFO', 'Diagnostics started');

            const results = [];

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
            const files = [
                { name: 'data/news.json', emoji: 'üì∞' },
                { name: 'data/comments.json', emoji: 'üí¨' },
                { name: 'data/categories.json', emoji: 'üè∑Ô∏è' },
                { name: 'data/templates.json', emoji: 'üìã' },
                { name: 'assets/css/style.css', emoji: 'üé®' },
                { name: 'assets/js/app.js', emoji: '‚öôÔ∏è' },
                { name: 'index.html', emoji: 'üìÑ' }
            ];

            for (const file of files) {
                try {
                    const response = await fetch(file.name);
                    const status = response.ok ? 'success' : 'error';
                    const message = response.ok ? '‚úÖ –ù–∞–π–¥–µ–Ω' : `‚ùå ${response.status}`;
                    
                    results.push({
                        name: `${file.emoji} ${file.name}`,
                        status: status,
                        message: message,
                        details: response.ok ? `Size: ${response.headers.get('content-length') || '?'} bytes` : 'File not found'
                    });
                    
                    addLog(status === 'success' ? 'SUCCESS' : 'ERROR', `File check: ${file.name}`, message);
                } catch (error) {
                    results.push({
                        name: `${file.emoji} ${file.name}`,
                        status: 'error',
                        message: '‚ùå –û—à–∏–±–∫–∞',
                        details: error.message
                    });
                    addLog('ERROR', `File check failed: ${file.name}`, error.message);
                }
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub (–ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê)
            const githubResult = await checkGitHubAPI();
            results.push(githubResult);

            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ LocalStorage
            const storageCheck = {
                name: 'üíæ LocalStorage',
                status: localStorage.getItem('techflow_admin_logged') ? 'success' : 'warning',
                message: localStorage.getItem('techflow_admin_logged') ? '‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ' : '‚ö†Ô∏è –ü—É—Å—Ç–æ',
                details: `Used: ${new Blob(Object.values(localStorage)).size} bytes`
            };
            results.push(storageCheck);

            // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
            if (performance.memory) {
                const memCheck = {
                    name: 'üß† –ü–∞–º—è—Ç—å',
                    status: performance.memory.usedJSHeapSize < performance.memory.jsHeapSizeLimit * 0.9 ? 'success' : 'warning',
                    message: performance.memory.usedJSHeapSize < performance.memory.jsHeapSizeLimit * 0.9 ? '‚úÖ OK' : '‚ö†Ô∏è –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ',
                    details: `Used: ${(performance.memory.usedJSHeapSize / 1048576).toFixed(2)} MB / ${(performance.memory.jsHeapSizeLimit / 1048576).toFixed(2)} MB`
                };
                results.push(memCheck);
            }

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            list.innerHTML = results.map(result => `
                <div class="diagnostic-item ${result.status}">
                    <div class="diagnostic-name">${result.name}</div>
                    <div class="diagnostic-status ${result.status === 'success' ? 'ok' : result.status === 'warning' ? 'warning' : 'failed'}">
                        ${result.message}
                    </div>
                </div>
                ${result.details ? `
                <div style="width: 100%; margin-top: 10px; background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 11px; color: #666;">
                    ${result.details.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                </div>
                ` : ''}
            `).join('');

            addLog('SUCCESS', 'Diagnostics completed', `${results.length} checks`);
        }

        async function checkGitHubAPI() {
            const name = 'üîå GitHub API';
            
            if (!githubToken || !githubUsername) {
                return {
                    name: name,
                    status: 'error',
                    message: '‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ',
                    details: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ token –∏ username –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö'
                };
            }

            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∞–º–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
                const tokenCheck = await fetch(`${GITHUB_API_URL}/user`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!tokenCheck.ok) {
                    addLog('ERROR', 'GitHub token invalid', `Status: ${tokenCheck.status}`);
                    return {
                        name: name,
                        status: 'error',
                        message: '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω',
                        details: `HTTP ${tokenCheck.status} - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö`
                    };
                }

                const userData = await tokenCheck.json();

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
                const repoCheck = await fetch(
                    `${GITHUB_API_URL}/repos/${githubUsername}/${githubRepo}`,
                    { headers: { 'Authorization': `token ${githubToken}` } }
                );

                if (!repoCheck.ok) {
                    addLog('ERROR', 'GitHub repo not accessible', `Status: ${repoCheck.status}`);
                    return {
                        name: name,
                        status: 'error',
                        message: '‚ùå –†–µ–ø–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                        details: `HTTP ${repoCheck.status} - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ username –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ`
                    };
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ news.json
                const fileCheck = await fetch(
                    `${GITHUB_API_URL}/repos/${githubUsername}/${githubRepo}/contents/data/news.json`,
                    { headers: { 'Authorization': `token ${githubToken}` } }
                );

                let fileStatus = 'success';
                let fileMessage = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                let fileDetails = `User: ${userData.login}\nRepo: ${githubUsername}/${githubRepo}\nBranch: main`;

                if (!fileCheck.ok) {
                    fileStatus = 'warning';
                    fileMessage = '‚ö†Ô∏è –§–∞–π–ª news.json –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    fileDetails += `\n–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É (${fileCheck.status})`;
                }

                addLog('SUCCESS', 'GitHub API working', `User: ${userData.login}`);

                return {
                    name: name,
                    status: fileStatus,
                    message: fileMessage,
                    details: fileDetails
                };

            } catch (error) {
                addLog('ERROR', 'GitHub API error', error.message);
                return {
                    name: name,
                    status: 'error',
                    message: '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è',
                    details: error.message
                };
            }
        }

        // ===== –õ–û–ì–ò =====
        function downloadLogs() {
            const logs = systemLogs.map(log => 
                `[${log.time}] ${log.type}: ${log.message}${log.details ? '\n  Details: ' + log.details : ''}`
            ).join('\n');

            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `techflow-logs-${new Date().toISOString().slice(0, 10)}.log`;
            a.click();

            addLog('SUCCESS', 'Logs downloaded');
        }

        function clearLogs() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏?')) {
                systemLogs = [];
                updateLogsDisplay();
                showMessage('‚úÖ –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã!', 'success');
                addLog('SUCCESS', 'Logs cleared');
            }
        }

        // ===== –°–û–û–ë–©–ï–ù–ò–Ø =====
        function showMessage(text, type) {
            const msg = document.getElementById('statusMessage');
            msg.textContent = text;
            msg.className = `status-message ${type} show`;

            setTimeout(() => {
                msg.classList.remove('show');
            }, 4000);
        }

        // ===== –í–´–•–û–î =====
        function logout() {
            localStorage.removeItem('techflow_admin_logged');
            window.location.href = '/';
        }

        // –ü–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchNews');
            if (searchInput) {
                searchInput.addEventListener('input', displayNewsList);
            }
        });
    </script>
</body>
</html>
