<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechFlow Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* –õ–û–ì–ò–ù */
        .login-screen {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
        }

        .login-screen h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .login-screen p {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .error-message {
            color: #d32f2f;
            margin-bottom: 15px;
            padding: 10px;
            background: #ffebee;
            border-radius: 6px;
            font-size: 13px;
            display: none;
            border-left: 4px solid #d32f2f;
        }

        .info-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            font-size: 13px;
            color: #555;
        }

        /* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ */
        .admin-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: none;
        }

        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            font-size: 24px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê */
        .diagnostic-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 6px;
            border-left: 4px solid #999;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .diagnostic-item.success {
            border-left-color: #388e3c;
            background: #e8f5e9;
        }

        .diagnostic-item.error {
            border-left-color: #d32f2f;
            background: #ffebee;
        }

        .diagnostic-item.warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }

        .diagnostic-item.loading {
            border-left-color: #1976d2;
            background: #e3f2fd;
        }

        .diagnostic-name {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .diagnostic-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .diagnostic-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }

        .diagnostic-icon.ok {
            background: #388e3c;
        }

        .diagnostic-icon.error {
            background: #d32f2f;
        }

        .diagnostic-icon.warning {
            background: #ff9800;
        }

        .diagnostic-icon.loading {
            background: #1976d2;
        }

        .error-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .error-log-empty {
            color: #4fd1c5;
            font-style: italic;
        }

        .error-log-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #4a5568;
        }

        .error-log-item:last-child {
            border-bottom: none;
        }

        .error-log-time {
            color: #90cdf4;
            margin-right: 8px;
        }

        .error-log-type {
            color: #fab1a0;
            font-weight: bold;
        }

        .error-log-message {
            color: #e2e8f0;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
            flex: none;
        }

        .btn-danger {
            background: #d32f2f;
        }

        .btn-success {
            background: #388e3c;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .tab-btn {
                min-width: 100px;
                padding: 10px;
                font-size: 11px;
            }

            .tab-content {
                padding: 20px;
            }

            .diagnostic-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .diagnostic-status {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- –õ–û–ì–ò–ù –≠–ö–†–ê–ù -->
    <div class="login-screen" id="loginScreen">
        <h1>üîê TechFlow Admin</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</p>
        
        <div class="error-message" id="errorMessage"></div>
        
        <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" placeholder="admin123" required autofocus>
            </div>
            <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
        </form>

        <div class="info-box" style="margin-top: 20px;">
            <strong>‚ÑπÔ∏è –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:</strong> admin123
        </div>
    </div>

    <!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <div>
                <h1>üì∞ TechFlow Admin Panel v2.2</h1>
            </div>
            <button class="logout-btn" onclick="handleLogout()">–í—ã—Ö–æ–¥</button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('add-news', event)">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="tab-btn" onclick="switchTab('manage-news', event)">‚úèÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
            <button class="tab-btn" onclick="switchTab('templates', event)">üìã –®–∞–±–ª–æ–Ω—ã</button>
            <button class="tab-btn" onclick="switchTab('settings', event)">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab-btn" onclick="switchTab('diagnostics', event)">üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
        </div>

        <!-- TAB 1: –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–û–°–¢–¨ -->
        <div class="tab-content active" id="tab-add-news">
            <div id="successMessage2" style="background: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

            <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3>üì° –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å GitHub</h3>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; font-size: 13px;">
                    <div id="statusIndicator" style="width: 12px; height: 12px; border-radius: 50%; background: #d32f2f;"></div>
                    <span id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>
                </div>
                <div class="info-box">
                    üí° <strong>–°–æ–≤–µ—Ç:</strong> –ù–æ–≤–æ—Å—Ç–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ data/news.json –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!
                </div>
            </div>

            <form id="addNewsForm" onsubmit="handleAddNews(event)">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 15px;">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    
                    <div class="form-group">
                        <label for="newsTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                        <input type="text" id="newsTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" required maxlength="200">
                        <div style="font-size: 12px; color: #999; margin-top: 4px;"><span id="titleCount">0</span>/200</div>
                    </div>

                    <div class="form-group">
                        <label for="newsCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <select id="newsCategory" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="ai">ü§ñ –ò–ò –∏ Machine Learning</option>
                            <option value="gadgets">üì± –ì–∞–¥–∂–µ—Ç—ã –∏ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã</option>
                            <option value="software">üíª –ü–û –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</option>
                            <option value="hardware">üîß –ñ–µ–ª–µ–∑–æ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</option>
                            <option value="crypto">üí∞ –ö—Ä–∏–ø—Ç–æ –∏ –±–ª–æ–∫—á–µ–π–Ω</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="newsAuthor">–ê–≤—Ç–æ—Ä *</label>
                        <input type="text" id="newsAuthor" placeholder="–í–∞—à–µ –∏–º—è –∏–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫" required>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 15px;">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
                    
                    <div class="form-group">
                        <label for="newsExcerpt">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ *</label>
                        <textarea id="newsExcerpt" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Å—É—Ç—å –Ω–æ–≤–æ—Å—Ç–∏." required maxlength="300" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; min-height: 100px;"></textarea>
                        <div style="font-size: 12px; color: #999; margin-top: 4px;"><span id="excerptCount">0</span>/300</div>
                    </div>

                    <div class="form-group">
                        <label for="newsFullText">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç *</label>
                        <textarea id="newsFullText" placeholder="–ü–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏." required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; min-height: 150px;"></textarea>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 15px;">–ú—É–ª—å—Ç–∏–º–µ–¥–∏–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</h3>
                    
                    <div class="form-group">
                        <label for="newsImage">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è *</label>
                        <input type="url" id="newsImage" placeholder="https://example.com/image.jpg" required onchange="updateImagePreview()">
                        <img id="imagePreview" style="margin-top: 10px; max-width: 200px; border-radius: 6px; display: none;" alt="–ü—Ä–µ–≤—å—é">
                    </div>

                    <div class="form-group">
                        <label for="newsSource">–ò—Å—Ç–æ—á–Ω–∏–∫ *</label>
                        <input type="url" id="newsSource" placeholder="https://example.com/news" required>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; margin: 15px 0;">
                        <input type="checkbox" id="newsFeatured" style="margin-right: 10px;">
                        <label for="newsFeatured">‚ú® –ò–∑–±—Ä–∞–Ω–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å</label>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-success">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                    <button type="reset" class="btn btn-secondary">üîÑ –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </form>
        </div>

        <!-- TAB 2: –£–ü–†–ê–í–õ–ï–ù–ò–ï -->
        <div class="tab-content" id="tab-manage-news">
            <div style="margin-bottom: 20px;">
                <input type="text" id="searchNews" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." onkeyup="filterNews()" style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; width: 100%; max-width: 300px;">
            </div>
            <div id="newsList"></div>
        </div>

        <!-- TAB 3: –®–ê–ë–õ–û–ù–´ -->
        <div class="tab-content" id="tab-templates">
            <h2>–®–∞–±–ª–æ–Ω—ã –Ω–æ–≤–æ—Å—Ç–µ–π:</h2>
            <div id="templatesGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;"></div>
        </div>

        <!-- TAB 4: –ù–ê–°–¢–†–û–ô–ö–ò -->
        <div class="tab-content" id="tab-settings">
            <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3>üì° GitHub API</h3>
                <div class="info-box" style="margin-bottom: 20px;">
                    ‚ÑπÔ∏è GitHub Token –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π.
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="githubToken">GitHub Token:</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                    <div style="font-size: 12px; color: #999; margin-top: 4px;">‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞</div>
                </div>

                <button class="btn btn-success" onclick="setGitHubToken()" style="max-width: 200px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Token</button>
            </div>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid #eee;">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="statsNews">0</div>
                        <div class="stat-label">–ù–æ–≤–æ—Å—Ç–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statsComments">0</div>
                        <div class="stat-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê -->
        <div class="tab-content" id="tab-diagnostics">
            <h2 style="margin-bottom: 20px;">üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>

            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px;">üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>
                <div id="diagnosticsList"></div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px;">üêõ –õ–æ–≥–∏ –æ—à–∏–±–æ–∫:</h3>
                <div class="error-log" id="errorLog">
                    <div class="error-log-empty">–û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success btn-small" onclick="runDiagnostics()">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
                    <button class="btn btn-danger btn-small" onclick="clearErrorLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
                    <button class="btn btn-secondary btn-small" onclick="downloadErrorLog()">üì• –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        const ADMIN_PASSWORD = 'admin123';
        let allNews = [];
        let allComments = {};
        let templates = [];
        let githubToken = null;
        let errorLog = [];
        let diagnosticResults = [];

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∫–æ–Ω—Å–æ–ª–∏
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;

        console.error = function(...args) {
            logError('ERROR', args.join(' '));
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            logError('WARNING', args.join(' '));
            originalWarn.apply(console, args);
        };

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º JS –æ—à–∏–±–∫–∏
        window.addEventListener('error', (event) => {
            logError('JS_ERROR', `${event.filename}:${event.lineno} - ${event.message}`);
        });

        // ===== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –û–®–ò–ë–û–ö =====
        function logError(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            errorLog.push({
                time: timestamp,
                type: type,
                message: message
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –µ—Å–ª–∏ –≤–∏–¥–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
            const errorLogDiv = document.getElementById('errorLog');
            if (errorLogDiv) {
                updateErrorLogUI();
            }

            // –•—Ä–∞–Ω–∏–º –º–∞–∫—Å–∏–º—É–º 100 –æ—à–∏–±–æ–∫
            if (errorLog.length > 100) {
                errorLog.shift();
            }
        }

        function updateErrorLogUI() {
            const errorLogDiv = document.getElementById('errorLog');
            
            if (errorLog.length === 0) {
                errorLogDiv.innerHTML = '<div class="error-log-empty">–û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ‚úÖ</div>';
                return;
            }

            errorLogDiv.innerHTML = errorLog.map((error, index) => `
                <div class="error-log-item">
                    <span class="error-log-time">[${error.time}]</span>
                    <span class="error-log-type">${error.type}</span>
                    <span class="error-log-message">: ${error.message}</span>
                </div>
            `).join('');

            // –°–∫—Ä–æ–ª–∏–º –≤–Ω–∏–∑
            errorLogDiv.scrollTop = errorLogDiv.scrollHeight;
        }

        function clearErrorLog() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫?')) {
                errorLog = [];
                updateErrorLogUI();
            }
        }

        function downloadErrorLog() {
            const logContent = errorLog.map(e => `[${e.time}] ${e.type}: ${e.message}`).join('\n');
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `techflow-errors-${new Date().toISOString().split('T')[0]}.log`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // ===== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê =====
        async function runDiagnostics() {
            diagnosticResults = [];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –§–∞–π–ª—ã
            await checkFile('data/news.json', 'JSON —Ñ–∞–π–ª –Ω–æ–≤–æ—Å—Ç–µ–π');
            await checkFile('data/comments.json', 'JSON —Ñ–∞–π–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤');
            await checkFile('data/template.json', 'JSON —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–æ–≤');
            await checkFile('assets/css/style.css', 'CSS —Å—Ç–∏–ª–∏');
            await checkFile('assets/js/app.js', 'JS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
            await checkFile('index.html', '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ë—Ä–∞—É–∑–µ—Ä
            checkBrowser();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: GitHub
            await checkGitHub();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ü–∞–º—è—Ç—å
            checkMemory();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateDiagnosticsUI();
        }

        async function checkFile(path, name) {
            try {
                const response = await fetch(path);
                const ok = response.ok;
                
                diagnosticResults.push({
                    name: name,
                    path: path,
                    status: ok ? 'success' : 'error',
                    message: ok ? `–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω (${response.headers.get('content-length') || '?'} –±–∞–π—Ç)` : `–û—à–∏–±–∫–∞ ${response.status}`,
                    time: new Date().toLocaleTimeString()
                });
            } catch (error) {
                logError('DIAGNOSTIC', `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ ${name}: ${error.message}`);
                diagnosticResults.push({
                    name: name,
                    path: path,
                    status: 'error',
                    message: error.message,
                    time: new Date().toLocaleTimeString()
                });
            }
        }

        function checkBrowser() {
            const browserInfo = {
                name: 'üåê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ',
                status: 'success',
                message: `${navigator.userAgent.substring(0, 50)}...`,
                time: new Date().toLocaleTimeString()
            };

            const storageTest = {
                name: 'üíæ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ',
                status: checkLocalStorage() ? 'success' : 'warning',
                message: checkLocalStorage() ? '–î–æ—Å—Ç—É–ø–Ω–æ' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞–º—è—Ç—å–±—Ä–∞—É–∑–µ—Ä–∞)',
                time: new Date().toLocaleTimeString()
            };

            diagnosticResults.push(browserInfo);
            diagnosticResults.push(storageTest);
        }

        function checkLocalStorage() {
            try {
                const test = '__storage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }

        async function checkGitHub() {
            if (!githubToken) {
                diagnosticResults.push({
                    name: 'üîå GitHub –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',
                    status: 'warning',
                    message: '–¢–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω',
                    time: new Date().toLocaleTimeString()
                });
                return;
            }

            try {
                const urlParts = window.location.pathname.split('/');
                const username = urlParts[1];
                const repo = urlParts[2] || 'techflow-news';

                const response = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    diagnosticResults.push({
                        name: 'üîå GitHub –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',
                        status: 'success',
                        message: `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ${username}/${repo}`,
                        time: new Date().toLocaleTimeString()
                    });
                } else {
                    diagnosticResults.push({
                        name: 'üîå GitHub –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',
                        status: 'error',
                        message: `–û—à–∏–±–∫–∞ ${response.status}: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π`,
                        time: new Date().toLocaleTimeString()
                    });
                }
            } catch (error) {
                logError('DIAGNOSTIC', `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ GitHub: ${error.message}`);
                diagnosticResults.push({
                    name: 'üîå GitHub –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',
                    status: 'error',
                    message: error.message,
                    time: new Date().toLocaleTimeString()
                });
            }
        }

        function checkMemory() {
            const memInfo = {
                name: '‚ö° –î–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏',
                status: 'success',
                message: `${allNews.length} –Ω–æ–≤–æ—Å—Ç–µ–π, ${Object.keys(allComments).length} –ø–æ—Ç–æ–∫–æ–≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤`,
                time: new Date().toLocaleTimeString()
            };

            diagnosticResults.push(memInfo);
        }

        function updateDiagnosticsUI() {
            const diagnosticsDiv = document.getElementById('diagnosticsList');

            diagnosticsDiv.innerHTML = diagnosticResults.map(result => {
                const iconClass = result.status === 'success' ? 'ok' : (result.status === 'error' ? 'error' : 'warning');
                const icon = result.status === 'success' ? '‚úÖ' : (result.status === 'error' ? '‚ùå' : '‚ö†Ô∏è');

                return `
                    <div class="diagnostic-item ${result.status}">
                        <div>
                            <div class="diagnostic-name">${result.name}</div>
                            <div style="color: #666; font-size: 12px; margin-top: 4px;">${result.message}</div>
                        </div>
                        <div class="diagnostic-status">
                            <span style="color: #999; font-size: 11px;">${result.time}</span>
                            <div class="diagnostic-icon ${iconClass}">${icon}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Admin Panel Initialized v2.2');
            loadNews();
            loadComments();
            loadTemplates();
            setupCharCounters();
        });

        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('password').value;

            console.log('Login attempt');

            if (password === ADMIN_PASSWORD) {
                console.log('‚úÖ Login successful');
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('password').value = '';
                updateUI();
            } else {
                console.log('‚ùå Login failed');
                document.getElementById('errorMessage').textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
                logError('LOGIN', '–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º');
            }
        }

        function handleLogout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏?')) {
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('password').value = '';
                githubToken = null;
                document.getElementById('githubToken').value = '';
            }
        }

        async function loadNews() {
            try {
                const response = await fetch('data/news.json');
                if (response.ok) {
                    allNews = await response.json();
                    console.log('News loaded:', allNews.length);
                } else {
                    allNews = [];
                }
            } catch (error) {
                logError('LOAD_NEWS', error.message);
                allNews = [];
            }
        }

        async function loadComments() {
            try {
                const response = await fetch('data/comments.json');
                if (response.ok) {
                    allComments = await response.json();
                } else {
                    allComments = {};
                }
            } catch (error) {
                logError('LOAD_COMMENTS', error.message);
                allComments = {};
            }
        }

        async function loadTemplates() {
            try {
                const response = await fetch('data/template.json');
                if (response.ok) {
                    templates = await response.json();
                    renderTemplates();
                }
            } catch (error) {
                logError('LOAD_TEMPLATES', error.message);
            }
        }

        async function handleAddNews(event) {
            event.preventDefault();

            const newsData = {
                id: 'news-' + Date.now(),
                title: document.getElementById('newsTitle').value.trim(),
                excerpt: document.getElementById('newsExcerpt').value.trim(),
                fullText: document.getElementById('newsFullText').value.trim(),
                category: document.getElementById('newsCategory').value,
                image: document.getElementById('newsImage').value.trim(),
                source: document.getElementById('newsSource').value.trim(),
                author: document.getElementById('newsAuthor').value.trim(),
                featured: document.getElementById('newsFeatured').checked,
                date: new Date().toISOString().split('T')[0],
                views: 0
            };

            console.log('Adding news:', newsData.title);

            if (!newsData.title || !newsData.category || !newsData.excerpt || !newsData.fullText) {
                logError('ADD_NEWS', '–ù–µ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã');
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            allNews.push(newsData);

            if (githubToken) {
                const success = await saveNewsToGitHub();
                if (success) {
                    showSuccess('‚úÖ –ù–æ–≤–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ GitHub!');
                    console.log('News saved to GitHub successfully');
                } else {
                    showSuccess('‚ö†Ô∏è –ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ GitHub');
                    logError('GITHUB_SAVE', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub');
                }
            } else {
                showSuccess('‚úÖ –ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            }

            document.getElementById('addNewsForm').reset();
            document.getElementById('imagePreview').style.display = 'none';
            updateUI();
        }

        async function saveNewsToGitHub() {
            try {
                const urlParts = window.location.pathname.split('/');
                const username = urlParts[1];
                const repo = urlParts[2] || 'techflow-news';

                const fileResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/data/news.json`, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                let sha = null;
                if (fileResponse.ok) {
                    const fileData = await fileResponse.json();
                    sha = fileData.sha;
                }

                const newsContent = JSON.stringify(allNews, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(newsContent)));

                const updateResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/data/news.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `üì∞ –ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å: ${allNews[allNews.length - 1].title}`,
                        content: encodedContent,
                        sha: sha
                    })
                });

                return updateResponse.ok;
            } catch (error) {
                logError('GITHUB_API', error.message);
                return false;
            }
        }

        function updateImagePreview() {
            const imageUrl = document.getElementById('newsImage').value;
            const preview = document.getElementById('imagePreview');
            
            if (imageUrl) {
                preview.src = imageUrl;
                preview.style.display = 'block';
                preview.onerror = () => {
                    preview.style.display = 'none';
                    logError('IMAGE_LOAD', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${imageUrl}`);
                };
            } else {
                preview.style.display = 'none';
            }
        }

        function setupCharCounters() {
            document.getElementById('newsTitle').addEventListener('input', (e) => {
                document.getElementById('titleCount').textContent = e.target.value.length;
            });

            document.getElementById('newsExcerpt').addEventListener('input', (e) => {
                document.getElementById('excerptCount').textContent = e.target.value.length;
            });
        }

        function deleteNews(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å?')) {
                allNews = allNews.filter(news => news.id !== id);
                console.log('News deleted:', id);
                saveNewsToGitHub();
                updateUI();
            }
        }

        function editNews(id) {
            const news = allNews.find(n => n.id === id);
            if (news) {
                document.getElementById('newsTitle').value = news.title;
                document.getElementById('newsCategory').value = news.category;
                document.getElementById('newsExcerpt').value = news.excerpt;
                document.getElementById('newsFullText').value = news.fullText;
                document.getElementById('newsImage').value = news.image;
                document.getElementById('newsSource').value = news.source;
                document.getElementById('newsAuthor').value = news.author;
                document.getElementById('newsFeatured').checked = news.featured;
                
                document.getElementById('titleCount').textContent = news.title.length;
                document.getElementById('excerptCount').textContent = news.excerpt.length;
                
                updateImagePreview();
                switchTab('add-news', null);
                
                allNews = allNews.filter(n => n.id !== id);
                updateUI();
            }
        }

        function filterNews() {
            const searchTerm = document.getElementById('searchNews').value.toLowerCase();
            const filtered = allNews.filter(news => news.title.toLowerCase().includes(searchTerm));
            renderNewsList(filtered);
        }

        function renderNewsList(newsList = allNews) {
            const newsListDiv = document.getElementById('newsList');
            
            if (newsList.length === 0) {
                newsListDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">–ù–æ–≤–æ—Å—Ç–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }

            newsListDiv.innerHTML = newsList.map(news => {
                const commentsCount = (allComments[news.id] || []).length;
                return `
                    <div style="border: 1px solid #eee; padding: 15px; border-radius: 6px; margin-bottom: 12px; background: #f9f9f9;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 8px;">${news.title}</div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 10px;">
                            <span style="margin-right: 15px;">üìÖ ${news.date}</span>
                            <span style="margin-right: 15px;">üë§ ${news.author}</span>
                            <span>üí¨ ${commentsCount}</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-success btn-small" onclick="editNews('${news.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-danger btn-small" onclick="deleteNews('${news.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTemplates() {
            const templatesDiv = document.getElementById('templatesGrid');
            
            if (!templates || templates.length === 0) {
                templatesDiv.innerHTML = '<p style="color: #999;">–®–∞–±–ª–æ–Ω—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</p>';
                return;
            }

            templatesDiv.innerHTML = templates.map((template, index) => `
                <div style="border: 2px solid #eee; padding: 20px; border-radius: 8px; cursor: pointer;" onclick="applyTemplate(${index})">
                    <h3>${template.emoji} ${template.name}</h3>
                    <p style="color: #666; margin: 10px 0;">${template.description}</p>
                    <button class="btn btn-success" style="font-size: 13px;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                </div>
            `).join('');
        }

        function applyTemplate(index) {
            const template = templates[index];
            if (template) {
                document.getElementById('newsTitle').value = template.title;
                document.getElementById('newsCategory').value = template.category;
                document.getElementById('newsExcerpt').value = template.excerpt;
                document.getElementById('newsFullText').value = template.fullText;
                document.getElementById('newsImage').value = template.image;
                document.getElementById('newsSource').value = template.source || '';
                document.getElementById('newsAuthor').value = template.author || '';

                document.getElementById('titleCount').textContent = template.title.length;
                document.getElementById('excerptCount').textContent = template.excerpt.length;

                updateImagePreview();
                switchTab('add-news', null);
                console.log('Template applied:', template.name);
            }
        }

        function setGitHubToken() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                logError('TOKEN', '–¢–æ–∫–µ–Ω –Ω–µ –≤–≤–µ–¥–µ–Ω');
                alert('–í–≤–µ–¥–∏—Ç–µ GitHub Token');
                return;
            }

            const urlParts = window.location.pathname.split('/');
            githubToken = token;
            
            console.log('GitHub Token set');
            
            document.getElementById('statusIndicator').classList.add('connected');
            document.getElementById('statusText').textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ GitHub';
            alert('‚úÖ GitHub Token —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage2');
            if (!successDiv) return;
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 4000);
        }

        function switchTab(tabName, event) {
            if (event) event.preventDefault();

            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById('tab-' + tabName).classList.add('active');
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => {
                if (btn.textContent.includes(getTabLabel(tabName))) {
                    btn.classList.add('active');
                }
            });

            // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'diagnostics') {
                setTimeout(() => runDiagnostics(), 100);
            }
        }

        function getTabLabel(tabName) {
            const labels = {
                'add-news': '–î–æ–±–∞–≤–∏—Ç—å',
                'manage-news': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',
                'templates': '–®–∞–±–ª–æ–Ω—ã',
                'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                'diagnostics': '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞'
            };
            return labels[tabName] || '';
        }

        function updateUI() {
            renderNewsList();
            
            document.getElementById('statsNews').textContent = allNews.length;
            
            let totalComments = 0;
            for (let key in allComments) {
                totalComments += allComments[key].length;
            }
            document.getElementById('statsComments').textContent = totalComments;

            if (githubToken) {
                document.getElementById('statusIndicator').classList.add('connected');
                document.getElementById('statusText').textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ GitHub';
            }
        }
    </script>
</body>
</html>
